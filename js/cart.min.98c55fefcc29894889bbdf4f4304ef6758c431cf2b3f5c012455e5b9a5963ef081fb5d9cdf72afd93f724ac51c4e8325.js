async function getCatalog(){return await(await fetch("/catalog.json")).json()}function getCart(){return JSON.parse(localStorage.getItem("cart"))||{}}function setCart(e){localStorage.setItem("cart",JSON.stringify(e))}async function addToCart(e){var n=await getCatalog(),t=getCart();e in n&&(t[e]?t[e].quantity+=1:t[e]={quantity:1},setCart(t))}function clearCart(){localStorage.removeItem("cart")}function changeQuantity(e,t){var n=getCart();console.log(e),n[e]&&n[e].quantity+t>0&&(n[e].quantity+=t),setCart(n)}async function displayCart(){var e,n,s,o,i,r,c,t=await getCatalog(),a=document.getElementById("cart-items");if(a!=null){a.innerHTML="",r=0,o=JSON.parse(localStorage.getItem("cart"))||{};for(e in o)Object.hasOwn(o,e)&&e in t&&(i=o[e],n=document.createElement("div"),n.classList.add("cart-item"),n.innerHTML=t[e].name+': <p class="cart-action" id="quantity-minus" data-id="'+e+'">-</p> '+i.quantity+' <p class="cart-action" id="quantity-plus" data-id="'+e+'">+</p>  x ',s=t[e].price,"discountedPrice"in t[e]&&(s=t[e].discountedPrice,n.innerHTML+='<span class="strikethrough">'+t[e].price+"Ft</span> "),n.innerHTML+=s+"Ft = <strong>"+i.quantity*s+"Ft</strong>",a.appendChild(n),r+=i.quantity*s);c=document.getElementById("final-price"),c.innerHTML=r+"Ft",document.querySelectorAll("#quantity-minus").forEach(function(e){e.addEventListener("click",function(){changeQuantity(e.getAttribute("data-id"),-1),displayCart()})}),document.querySelectorAll("#quantity-plus").forEach(function(e){e.addEventListener("click",function(){changeQuantity(e.getAttribute("data-id"),+1),displayCart()})})}else console.log("displayCart: Can't display cart, no container.")}window.addEventListener("DOMContentLoaded",displayCart),window.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("payment-form");e?e.addEventListener("submit",clearCart):console.log("on DOMContentLoaded: no payment-form, probably not on checkout."),document.querySelectorAll(".buy").forEach(e=>{e.addEventListener("click",function(){addToCart(e.dataset.id)})})})